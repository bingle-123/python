# AMQP 协议(Advanced Message Queuing Protocol)

一个提供统一消息服务的应用层标准高级消息队列协议,是应用层协议的一个开放标准,为面向消息的中间件设计。基于此协议的客户端与消息中间件可传递消息，并不受客户端/中间件不同产品，不同的开发语言等条件的限制

## AMQP模型

AMQP模型描述了一套模块化的组件以及这些组件之间进行连接的标准规则。

### 在服务器中，三个主要功能模块连接成一个处理链完成预期的功能

- `exchange` 接收发布应用程序发送的消息，并根据一定的规则将这些消息路由到消息队列 
- `message queue` 存储消息，直到这些消息被消费者安全处理完为止
- `binding` 定义了 `exchange` 和 `message queue` 之间的关联，提供路由规则

> 一个AMQP服务器类似于邮件服务器，exchange类似于消息传输代理（email里的概念），message queue类似于邮箱。Binding定义了每一个传输代理中的消息路由表，发布者将消息发给特定的传输代理，然后传输代理将这些消息路由到邮箱中，消费者从这些邮箱中取出消息。

### AMQP通常被划分为三层
- 模型层: 定义了一套命令（按功能分类），客户端应用可以利用这些命令来实现它的业务功能。
- 会话层: 负责将命令从客户端应用传递给服务器，再将服务器的应答传递给客户端应用，会话层为这个传递过程提供可靠性、同步机制和错误处理。
- 传输层: 提供帧处理、信道复用、错误检测和数据表示。

### 术语
- AMQP模型（AMQP Model）：一个由关键实体和语义表示的逻辑框架，遵从AMQP规范的服务器必须提供这些实体和语义。为了实现本规范中定义的语义，客户端可以发送命令来控制AMQP服务器。
- 连接（Connection）：一个网络连接，比如TCP/IP套接字连接。
- 会话（Session）：端点之间的命名对话。在一个会话上下文中，保证“恰好传递一次”。
- 信道（Channel）：多路复用连接中的一条独立的双向数据流通道。为会话提供物理传输介质。
- 客户端（Client）：AMQP连接或者会话的发起者。AMQP是非对称的，客户端生产和消费消息，服务器存储和路由这些消息。
- 服务器（Server）：接受客户端连接，实现AMQP消息队列和路由功能的进程。也称为“消息代理”。
- 端点（Peer）：AMQP对话的任意一方。一个AMQP连接包括两个端点（一个是客户端，一个是服务器）。
- 搭档（Partner）：当描述两个端点之间的交互过程时，使用术语“搭档”来表示“另一个”端点的简记法。比如我们定义端点A和端点B，当它们进行通信时，端点B是端点A的搭档，端点A是端点B的搭档。
- 片段集（Assembly）：段的有序集合，形成一个逻辑工作单元。
- 段（Segment）：帧的有序集合，形成片段集中一个完整子单元。
- 帧（Frame）：AMQP传输的一个原子单元。一个帧是一个段中的任意分片。
- 控制（Control）：单向指令，AMQP规范假设这些指令的传输是不可靠的。
- 命令（Command）：需要确认的指令，AMQP规范规定这些指令的传输是可靠的。
- 异常（Exception）：在执行一个或者多个命令时可能发生的错误状态。
- 类（Class）：一批用来描述某种特定功能的AMQP命令或者控制。
- 消息头（Header）：描述消息数据属性的一种特殊段。
- 消息体（Body）：包含应用程序数据的一种特殊段。消息体段对于服务器来说完全透明——服务器不能查看或者修改消息体。
- 消息内容（Content）：包含在消息体段中的的消息数据。
- 交换器（Exchange）：服务器中的实体，用来接收生产者发送的消息并将这些消息路由给服务器中的队列。
- 交换器类型（Exchange Type）：基于不同路由语义的交换器类。
- 消息队列（Message Queue）：一个命名实体，用来保存消息直到发送给消费者。
- 绑定器（Binding）：消息队列和交换器之间的关联。
- 绑定器关键字（Binding Key）：绑定的名称。一些交换器类型可能使用这个名称作为定义绑定器路由行为的模式。
- 路由关键字（Routing Key）：一个消息头，交换器可以用这个消息头决定如何路由某条消息。
- 持久存储（Durable）：一种服务器资源，当服务器重启时，保存的消息数据不会丢失。
- 临时存储（Transient）：一种服务器资源，当服务器重启时，保存的消息数据会丢失。
- 持久化（Persistent）：服务器将消息保存在可靠磁盘存储中，当服务器重启时，消息不会丢失。
- 非持久化（Non-Persistent）：服务器将消息保存在内存中，当服务器重启时，消息可能丢失。
- 消费者（Consumer）：一个从消息队列中请求消息的客户端应用程序。
- 生产者（Producer）：一个向交换器发布消息的客户端应用程序。
- 虚拟主机（Virtual Host）：一批交换器、消息队列和相关对象。虚拟主机是共享相同的身份认证和加密环境的独立服务器域。客户端应用程序在登录到服务器之后，可以选择一个虚拟主机。